# v0.3.0 Implementation Status

**Target:** "Behaves like IAM. Debugs better than GCP."

**Strategy:** Full suite integration - IAM as the shared auth brain for KMS + Secret Manager.

---

## Phase 1: Core IAM Features (Days 1-10)

### 1. Groups Support ⏳ Not Started
**Estimated:** 1-2 days

- [ ] Add `groups:` section to YAML config
- [ ] Implement group expansion in `principalMatches()`
- [ ] Support nested groups (1 level)
- [ ] Add tests for group membership
- [ ] Update policy.yaml.example with groups

### 2. Conditional Bindings ✅ Complete
**Estimated:** 3-4 days | **Actual:** 3 days

- [x] Add `Condition` struct to config and proto
- [x] Implement basic CEL evaluator:
  - [x] `resource.name.startsWith(prefix)`
  - [x] `resource.type == "SECRET" | "CRYPTO_KEY"`
  - [x] `request.time < timestamp(...)`
- [x] Evaluate conditions in `hasPermission()`
- [x] Log condition evaluation results in trace mode
- [x] Add tests for conditional bindings
- [ ] Document CEL subset in README

### 3. Policy Schema v3 ✅ Complete
**Estimated:** 2-3 days | **Actual:** 2 days

- [x] Add `etag` field to Policy
- [x] Add `version` field to Policy (1=basic, 3=conditions)
- [x] Add `auditConfig` field to Policy
- [x] Maintain backward compatibility with v1 config
- [x] Update config loader to support both formats
- [x] Update policy.yaml.example with v3 features

---

## Phase 2: Usability & Debuggability (Days 11-15)

### 4. REST Gateway ⏳ Not Started
**Estimated:** 3-4 days

- [ ] HTTP handler for SetIamPolicy
- [ ] HTTP handler for GetIamPolicy
- [ ] HTTP handler for TestIamPermissions
- [ ] JSON request/response marshaling
- [ ] Error code mapping (gRPC → HTTP)
- [ ] `--http-port` CLI flag
- [ ] Integration tests for REST endpoints
- [ ] Update README with REST examples

### 5. Enhanced Trace Mode ⏳ Not Started
**Estimated:** 2-3 days

- [ ] JSON trace output format
- [ ] `--trace-output <file>` flag for JSON traces
- [ ] `--explain` flag for verbose logging
- [ ] Include condition evaluation in traces
- [ ] Include checked bindings in traces
- [ ] Add duration metrics to traces
- [ ] Document trace format in README

---

## Phase 3: Emulator Suite Integration (Days 16-26)

### 6. KMS Emulator Integration ⏳ Not Started
**Estimated:** 2-3 days

- [ ] Add IAM client to KMS emulator
- [ ] Check `IAM_EMULATOR_HOST` env var
- [ ] Call TestIamPermissions before each operation
- [ ] Map KMS methods to required permissions
- [ ] Return PERMISSION_DENIED on authz failure
- [ ] Add integration tests
- [ ] Update KMS emulator README

### 7. Secret Manager Emulator Integration ⏳ Not Started
**Estimated:** 2-3 days

- [ ] Add IAM client to Secret Manager emulator
- [ ] Check `IAM_EMULATOR_HOST` env var
- [ ] Call TestIamPermissions before each operation
- [ ] Map Secret Manager methods to required permissions
- [ ] Return PERMISSION_DENIED on authz failure
- [ ] Add integration tests
- [ ] Update Secret Manager emulator README

### 8. Full Stack Example ⏳ Not Started
**Estimated:** 1-2 days

- [ ] Create `docker-compose.yml` with all 3 emulators
- [ ] Create example `policy.yaml` for full stack
- [ ] Add end-to-end integration test script
- [ ] Document full stack setup in README
- [ ] Create "Quick Start" guide for the stack

---

## Phase 4: Documentation & Release (Days 27-30)

### 9. Documentation Updates ⏳ Not Started

- [ ] Update CHANGELOG.md for v0.3.0
- [ ] Update README.md with new features
- [ ] Update FEATURES.md with v0.3.0 additions
- [ ] Create blog post: "Local GCP Stack with Real IAM"
- [ ] Update ROADMAP.md to remove completed items

### 10. Testing & Quality ⏳ Not Started

- [ ] Run full test suite
- [ ] Fix any linter warnings
- [ ] Performance test (condition evaluation overhead)
- [ ] Security review (CEL expression safety)
- [ ] CI pipeline verification

---

## Success Metrics

v0.3.0 is complete when:

1. ✅ Groups work in policy files and reduce duplication
2. ✅ Conditional bindings evaluate correctly with basic CEL
3. ✅ REST gateway serves all 3 IAM methods
4. ✅ Trace output includes condition evaluation results
5. ✅ KMS emulator enforces IAM permissions
6. ✅ Secret Manager emulator enforces IAM permissions
7. ✅ Docker Compose stack works end-to-end
8. ✅ All tests pass (unit + integration + e2e)
9. ✅ Documentation is complete and accurate
10. ✅ Release notes explain "Behaves like IAM. Debugs better than GCP."

---

## Current Status

**Phase:** Phase 1 in progress  
**Days elapsed:** 5 / 30  
**Completion:** 29% (13/45 tasks)

**Completed:**
- ✅ Conditional bindings (CEL evaluator, condition evaluation, tests)
- ✅ Policy Schema v3 (etag, version, auditConfigs, full YAML support)

**Next action:** Complete Phase 1 - Implement groups support, then document CEL subset in README
